Preparing vulnerability curves
==============================

To calculate the level of impact from a hazard event, users need to
provide information on the vulnerability of different building types
to the hazard measure used. The vulnerability describes the level of
damage, given a specific intensity of the hazard.

.. figure:: ../examples/diagrams/example_vuln_curve.png
   :align: center

   *An example vulnerability curve.*

Structuring vulnerability functions
-----------------------------------

The folder `hazimp_preprocessing/curve_data` contains example
formatted CSV files of vulnerability, which can be converted to the
required XML format using the `create_vuln_xml.py` script.

The first row of the CSV file contains column labels, some of which are unique to each hazard. Key fields in the CSV include::
  
  - `vulnerabilityFunctionID`
  - `vulnerabilitySetID`
  - `lossCategory`
  - `defaultLoss`
  - `IMT` - intensity measure type (the way the hazard is measured)
  - `IML` - intensity measure levels (the hazard levels for which damage/loss ratios are provided)

Additional fields may be included to facilitate demarcation of
different vulnerability groups. For example, the
`domestic_wind_vul_curves.csv` includes fields of `Region`, `Age`,
`AS4055_class`, `Roof material` and `Wall material`. These attributes
are all used to assign an appropriate vulnerability curve to the
builiding.

The `vulnerabilityFunctionID` value is a unique identifier to each vulnerability function. 



Generating a vulnerability xml file
-----------------------------------

Once an appropriate CSV file has been generated, the curve data is
converted to an XML file using the `create_vuln_xml.py` script. Edit
the lines below `if __name__ == "__main__":` to turn on the processing
of individual CSV files. For example, to process a CSV file called
`domestic_wind_vuln_curves.csv`, there should be a line like the
following::

    if True:
        csv_curve2nrml('domestic_wind_vul_curves.csv',
                       'domestic_wind_vul_curves.xml')

Then run the script at the command line::

  cd hazimp_preprocessing/curve_data
  python create_vuln_xml.py

This should generate a file called `domestic_wind_vul_curves.xml` in
the working directory (`hazimp_preprocessing/curve_data`). This xml
file can then be referenced in the :ref:`Templates` to run HazImp.
